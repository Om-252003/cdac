1) create table

CREATE TABLE IF NOT EXISTS taxidata
(vendor_id string, pickup_datetime string, 
dropoff_datetime string, passenger_count int, trip_distance DOUBLE,
pickup_longitude DOUBLE, pickup_latitude DOUBLE, rate_code int,
store_and_fwd_flag string, dropoff_longitude DOUBLE, dropoff_latitude
DOUBLE,
payment_type string, fare_amount DOUBLE, extra DOUBLE,
mta_tax DOUBLE,tip_amount DOUBLE,tolls_amount DOUBLE,
total_amount DOUBLE,trip_time_in_secs int)
ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' STORED as TEXTFILE
TBLPROPERTIES ("skip.header.line.count"="1");



2) load data into that table

LOAD DATA INPATH '/user/hadoop/data/yellow.csv' INTO TABLE taxidata;



3) see head 5 rows

select * from taxidata limit 5;

see notes pdf.

4) Run some queries to practice

1. What is the total revenue generated by all the trips ? Fare is stored in the columntotal_amount.
select sum(total_amount) as total_revenue from taxidata;

2. What fraction of the total is paid for tolls? Toll is stored in tolls_amount.
select sum(tolls_amount)/sum(total_amount) as toll_pct from taxidata;

3. What fraction of it is driver tips? Tip is stored in tip_amount.
select sum(tip_amount)/sum(total_amount) as tip_pct from taxidata;





CREATE TABLE IF NOT EXISTS taxidatamylocation
(vendor_id string, pickup_datetime string, 
dropoff_datetime string, passenger_count int, trip_distance DOUBLE,
pickup_longitude DOUBLE, pickup_latitude DOUBLE, rate_code int,
store_and_fwd_flag string, dropoff_longitude DOUBLE, dropoff_latitude
DOUBLE,
payment_type string, fare_amount DOUBLE, extra DOUBLE,
mta_tax DOUBLE,tip_amount DOUBLE,tolls_amount DOUBLE,
total_amount DOUBLE,trip_time_in_secs int)
ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' STORED as TEXTFILE
LOCATION '/user/hadoop/data/'
TBLPROPERTIES ("skip.header.line.count"="1");


CREATE EXTERNAL TABLE IF NOT EXISTS taxidata_exc
(vendor_id string, pickup_datetime string, 
dropoff_datetime string, passenger_count int, trip_distance DOUBLE,
pickup_longitude DOUBLE, pickup_latitude DOUBLE, rate_code int,
store_and_fwd_flag string, dropoff_longitude DOUBLE, dropoff_latitude
DOUBLE,
payment_type string, fare_amount DOUBLE, extra DOUBLE,
mta_tax DOUBLE,tip_amount DOUBLE,tolls_amount DOUBLE,
total_amount DOUBLE,trip_time_in_secs int)
ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' STORED as TEXTFILE
LOCATION '/user/hadoop/external';
